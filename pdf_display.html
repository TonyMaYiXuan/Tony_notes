<!DOCTYPE html>
<html>
    <body>
        <p id="non_iOS">
            <iframe id="main_display" width="100%" height="1440px" type="application/pdf"></iframe> <!-- Need "px" -->
        </p>
        <font size=#444444 size=+2 face="Consolas">
            <p id="iOS" align=center> <!-- Don't put <center> or <pre> inside <p></p> or else you cannot control whether it is displayed by the below script -->
                Sorry, iOS is currently not supported <sub>as I am too lazy to implement</sub>.
            </p>
        </font>
        <script type="module"> // remember "type=..." and we use "module" because there is import statement below, see https://usefulangle.com/post/252/script-type-module
            function hideAll() {
                document.getElementById("non_iOS").style.display = "none";
                document.getElementById("iOS").style.display = "none";
            }
            var base64 = {};
            base64.PADCHAR = '=';
            base64.ALPHA = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';
            base64.getbyte64 = function(s,i) {
                return base64.ALPHA.indexOf(s.charAt(i));
            }
            base64.decode = function(s) { // I suppose no need throw exception, but you may refer to here: https://stackoverflow.com/a/11527586
                s = "" + s; // convert to string
                var getbyte64 = base64.getbyte64;
                var pads, i, b10;
                var imax = s.length;
                if (imax === 0) {
                    return s;
                }
                pads = 0
                if (s.charAt(imax - 1) === base64.PADCHAR) {
                    pads = 1;
                    if (s.charAt(imax - 2) === base64.PADCHAR) {
                        pads = 2;
                    }
                    imax -= 4;
                }
                var x = [];
                for (i = 0; i < imax; i += 4) {
                    b10 = (getbyte64(s,i) << 18) | (getbyte64(s,i+1) << 12) | (getbyte64(s,i+2) << 6) | getbyte64(s,i+3);
                    x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 0xff, b10 & 0xff));
                }
                switch (pads) {
                case 1:
                    b10 = (getbyte64(s,i) << 18) | (getbyte64(s,i+1) << 12) | (getbyte64(s,i+2) << 6);
                    x.push(String.fromCharCode(b10 >> 16, (b10 >> 8) & 0xff));
                    break;
                case 2:
                    b10 = (getbyte64(s,i) << 18) | (getbyte64(s,i+1) << 12);
                    x.push(String.fromCharCode(b10 >> 16));
                    break;
                }
                return x.join('');
            }
            import { Octokit } from "https://cdn.skypack.dev/@octokit/rest";
            const octokit = new Octokit();
            async function showFile() {
                var arrPDFFileName = [], arrDriveFileName = [], arrDriveFileName_tmp = [];
                var userAgent = navigator.userAgent || navigator.vendor || window.opera; // carefully copy from https://stackoverflow.com/a/21742107
                var tmp_string = ((/android/i.test(userAgent))? "/Links_Google_Drive_PDF.txt" : "");
                const response = await octokit.request(("GET /repos/tonymayixuan/Introducing_Rigorous_Mathematics/contents/PDF" + tmp_string), {
                    owner: 'tonymayixuan',
                    repo: 'Introducing_Rigorous_Mathematics',
                    path: 'PDF' + tmp_string
                });
                hideAll();
                if (/android/i.test(userAgent)) { //TODO Better even take into account the resolution of the screen and put the website respectively
                    arrDriveFileName_tmp = base64.decode(response.data.content).split("\n"); /* atob is not supported in my Android browser */
                    for (var i = arrDriveFileName_tmp.length - 2 /* last element empty */; i >= 0; i--) {
                        arrDriveFileName.push("https://drive.google.com/file/d/" + arrDriveFileName_tmp[i] + "/preview");
                    }
                    document.getElementById("non_iOS").style.display = "block";
                    document.getElementById("main_display").src = arrDriveFileName[0];
                } else if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
                    document.getElementById("iOS").style.display = "block";
                }
                else {
                    response.data.forEach(datum => {if (datum.name.substring(datum.name.lastIndexOf("."), datum.name.length) === ".pdf") {arrPDFFileName[arrPDFFileName.length] = datum.name; }}); // {} to enclose "if", see https://stackoverflow.com/a/37627802
                    arrPDFFileName.sort(function (string_a, string_b) {return string_b.localeCompare(string_a)}); // descending order; already ascending alphabetical order of its name when "response"
                    document.getElementById("non_iOS").style.display = "block";
                    document.getElementById("main_display").src = "https://tonymayixuan.github.io/Introducing_Rigorous_Mathematics/PDF/" + arrPDFFileName[0];
                }
            }
            showFile(); // be aware that the async function may not be EXECUTED BEFORE the following lines
        </script>
    </body>
</html>
